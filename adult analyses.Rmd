---
title: "Giant anteater revisions (adult)"
output:
  word_document: default
  html_document: default
date: "2024-01-25"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load-packages, warning = FALSE, message = FALSE}
# Load packages
library(ctmm)
library(dplyr)
library(tidyverse)
library(glmmTMB)
library(lme4)

```

The pre-print analyses contained 23 range-resident giant anteaters. Within the 23 individuals contained 12 males (8 adults, 4 subadults) and 11 females (all adults).
This script is based on adult giant anteaters only. Subadults have been removed.

```{r import-data, eval = FALSE, message = FALSE}
#import data, cleaned giant anteater GPS tracking data, containing no outliers
COLLAR_DATA <- read.csv("data/Anteaters_NoOutliers.csv")

#correct mismatch ID entries
COLLAR_DATA$ID[COLLAR_DATA$ID == "Larry 267"] <- "Larry"

COLLAR_DAT <- data.frame(timestamp = COLLAR_DATA$timestamp,
                         ID = COLLAR_DATA$ID,
                         GPS.Latitude = COLLAR_DATA$GPS.Latitude,
                         GPS.Longitude = COLLAR_DATA$GPS.Longitude,
                         GPS.Horizontal.Dilution = COLLAR_DATA$GPS.Horizontal.Dilution,
                         OUT = COLLAR_DATA$OUT,
                         Road = COLLAR_DATA$Road)

#subset to the 20 adult range-resident individuals
anteater_data <- COLLAR_DAT[which(COLLAR_DAT$ID 
                                  %in% c("Alexander", "Annie", "Beto", "Bumpus", "Cate", 
                                         "Christoffer","Elaine", "Hannah","Jackson", "Jane", 
                                         "Larry", "Luigi", "Makao", "Margaret", "Maria", 
                                         "Puji", "Rodolfo", "Sheron", "Thomas")),]
```

```{r}
anteater_data <- readRDS("data/anteater_data_adults.rds")
```

```{r message =FALSE}
#import supplementary data containing biological information
DATA_META <- read.csv("data/Anteater_Results_Final.csv")

#subset biological data from supplementary data
bio_data <- DATA_META[which(DATA_META$ID 
                            %in% c("Alexander", "Annie", "Beto", "Bumpus", "Cate", 
                                   "Christoffer","Elaine", "Hannah","Jackson", "Jane", 
                                   "Larry", "Luigi", "Makao", "Margaret", "Maria", 
                                   "Puji", "Rodolfo", "Sheron", "Thomas")),c(1:5)]

#add site location 
bio_data$Site[bio_data$Road == "MS-040"] <- 1
bio_data$Site[bio_data$Road == "BR_267"] <- 2

#add bio data
anteater_data <- merge(anteater_data, bio_data, all = TRUE)

#convert dataset to a telemetry object
DATA_TELEMETRY <- as.telemetry(anteater_data)

```

```{r}
#import movement models
load("data/anteater_fit.rda")

#subset to adults only
FIT <- FIT[-c(3,12,14,20)]

#import home-range estimates
load("data/anteater_AKDE.rda")

#subset to adults only
AKDE <- AKDE[-c(3,12,14,20)]

```

## Home-range results

```{r}
#Mean HR size...
meta(AKDE)

#Compare between sex...
AKDE_male <- AKDE[c("Alexander", "Beto","Christoffer","Jackson", "Larry", 
                    "Luigi", "Rodolfo", "Thomas")]
AKDE_female <- AKDE[c("Annie", "Bumpus", "Cate", "Elaine", "Hannah",
                      "Jane","Makao", "Margaret", "Maria", "Puji",
                      "Sheron")]

#calculate mean home range sizes for male
meta(AKDE_male)

#calculate mean home range sizes for female
meta(AKDE_female)

#female/male ratio of mean home-range areas
AKDE_sex_compare <- list(male = AKDE_male,
                         female = AKDE_female)
meta(AKDE_sex_compare, col = c("#004488", "#A50026"), sort = TRUE)

```


## Estimating home-range overlap

```{r}
#subset home range overlap based on site location
AKDE_1 <- AKDE[c("Alexander", "Bumpus", "Cate", "Christoffer",
                 "Elaine", "Jackson", "Makao",
                 "Puji", "Rodolfo")]

AKDE_2 <- AKDE[c("Annie", "Beto", "Hannah", "Jane", "Larry",
                 "Luigi", "Margaret", "Maria", "Sheron",
                 "Thomas")]

#calculate 95% AKDE home range overlap for a pairwise comparison for each site
overlap1 <- overlap(AKDE_1, level = 0.95)
overlap2 <- overlap(AKDE_2, level = 0.95)

overlap_data <- readRDS("data/home_range/overlap_data_adults.rds")
```

# Home-range overlap results

```{r}
#Is sex a factor?...

#rescale the values
min_val <- min(overlap_data$overlap_est)
max_val <- max(overlap_data$overlap_est)
squeeze_min <- 0.001
squeeze_max <- 0.999
overlap_data$overlap_est_squeezed <- ((overlap_data$overlap_est - min_val) / (max_val - min_val)) * (squeeze_max - squeeze_min) + squeeze_min

#compare model with and without sex as a variable
HRO_test <- glmmTMB(overlap_est_squeezed ~ sex_comparison + (1|site), 
                    family = beta_family(link = "logit"), data = overlap_data)
HRO_test2 <- glmmTMB(overlap_est_squeezed ~ 1 + (1|site), 
                     family = beta_family(link = "logit"), data = overlap_data)
HRO_test_results <- anova(HRO_test, HRO_test2)
HRO_test_results

#calculate sex impact via likelihood ratio test
HRO_test_pvalue <- round(HRO_test_results$`Pr(>Chisq)`[2], 2)
HRO_test_pvalue


```


```{r}
#Home range overlap results based on sex comparisons (i.e.. male-male, female-female, and female-male).

#number of home range overlap in each sex comparison category
table(overlap_data$sex_comparison)

#calculate mean home range overlap and the range based on sex comparisons
round(mean(overlap_data$overlap_est[overlap_data$sex_comparison == "male-male"]), 2)
round(min(overlap_data$overlap_est[overlap_data$sex_comparison == "male-male"]), 2)
round(max(overlap_data$overlap_est[overlap_data$sex_comparison == "male-male"]), 2)

round(mean(overlap_data$overlap_est[overlap_data$sex_comparison == "female-female"]), 2)
round(min(overlap_data$overlap_est[overlap_data$sex_comparison == "female-female"]), 2)
round(max(overlap_data$overlap_est[overlap_data$sex_comparison == "female-female"]), 2)

round(mean(overlap_data$overlap_est[overlap_data$sex_comparison == "female-male"]), 2)
round(min(overlap_data$overlap_est[overlap_data$sex_comparison == "female-male"]), 2)
round(max(overlap_data$overlap_est[overlap_data$sex_comparison == "female-male"]), 2)
```


# Estimating proximity ratio



```{r}
#import proximity data
proximity_data <- readRDS("data/proximity/proximity_df.rds")
proximity_data <- as.data.frame(proximity_data)

#remove subadults from proximity data
proximity_data <- proximity_data[!(proximity_data$anteater_A %in% "Anthony" | proximity_data$anteater_B %in% "Anthony"),]
proximity_data <- proximity_data[!(proximity_data$anteater_A %in% "Kyle" | proximity_data$anteater_B %in% "Kyle"),]
proximity_data <- proximity_data[!(proximity_data$anteater_A %in% "Little_Rick" | proximity_data$anteater_B %in% "Little_Rick"),]
proximity_data <- proximity_data[!(proximity_data$anteater_A %in% "Reid" | proximity_data$anteater_B %in% "Reid"),]

#combine overlap and proximity data
overlap_data <- merge(overlap_data, proximity_data, all = TRUE)
```

# Proximity ratio results

```{r}
#test for significance in sex, compare model with and without sex as a variable
proximity_test <- glmer(proximity_est ~ sex_comparison + (1|site), 
                        family = Gamma(link = "log"), data = overlap_data)
proximity_test2 <- glmer(proximity_est ~ 1 + (1|site), 
                         family = Gamma(link = "log"), data = overlap_data)
proximity_test_results <- anova(proximity_test, proximity_test2)

#calculate sex impact on proximity ratio via likelihood ratio test
proximity_test_pvalue <- round(proximity_test_results$`Pr(>Chisq)`[2], 2)
proximity_test_pvalue

#compare model with and without overlap as a variable
prox_overlap_test <- glmer(proximity_est ~ overlap_est + (1|site), 
                           family = Gamma(link = "log"), data = overlap_data)
prox_overlap_test2 <- glmer(proximity_est ~ 1 + (1|site), 
                            family = Gamma(link = "log"), data = overlap_data)
prox_overlap_test_results <- anova(prox_overlap_test, prox_overlap_test2)

#calculate home-range overlap impact via likelihood ratio test
prox_overlap_test_pvalue <- round(prox_overlap_test_results$`Pr(>Chisq)`[2], 2)
prox_overlap_test_pvalue
```


# Estimating encounters


```{r echo = FALSE}
#import distance data
distance_data <- readRDS("data/proximity/distance_data_adults.rds")

overlap_data$encounter_count <- NA
pair_ID <- unique(overlap_data$pair_ID)

#calculate total encounters of all individuals based on sex comparison type
for (i in pair_ID){
  subset_A <- distance_data[distance_data$pair_ID == i,]
  
  #count the number of times distance is below 15
  encounter_count <- sum(subset_A$distance_est < 15)
  
  #save results
  overlap_data[overlap_data$pair_ID == i, "encounter_count"] <- encounter_count
  
}

```

# Encounter results


```{r}

#calculate the number of encounters based on threshold of 15m
sum(overlap_data$encounter_count)
sum(overlap_data$encounter_count[overlap_data$sex_comparison == "male-male"])
sum(overlap_data$encounter_count[overlap_data$sex_comparison == "female-female"])
sum(overlap_data$encounter_count[overlap_data$sex_comparison == "female-male"])

#effect of sex and overlap on encounter rates and does not include 0 encounter counts
encounter_test <- glmer(encounter_count ~ overlap_est + sex_comparison + (1|site), 
                        family = poisson(link = "log"), 
                        data = overlap_data, subset = encounter_count > 0)
encounter_test2 <- glmer(encounter_count ~ 1 + (1|site), 
                         family = poisson(link = "log"), 
                         data = overlap_data, subset = encounter_count > 0)
encounter_test_results <- anova(encounter_test, encounter_test2)
encounter_test_results

#calculate sex impact on encounters via likelihood ratio test
encounter_test_pvalue <- round(encounter_test_results$`Pr(>Chisq)`[2], 2)
encounter_test_pvalue

#amount of home range overlap and the number of observed encounters
summary(encounter_test)
```


# Deviated pairs

```{r}
#import identified deviated pairs (7 pairs)
proximity_identified_pairs_df <- readRDS("data/proximity/proximity_identified_adult_pairs_df.rds")

#number of pairs with a deviated proximity ratio based on sex comparison
table(proximity_identified_pairs_df$sex_comparison)

#test for significance in sex, compare model with and without sex as a variable
proximity_test_pairs <- glmer(proximity_est ~ sex_comparison + (1|site), 
                              family = Gamma(link = "log"), 
                              data = proximity_identified_pairs_df)
proximity_test2_pairs <- glmer(proximity_est ~ 1 + (1|site), 
                               family = Gamma(link = "log"), 
                               data = proximity_identified_pairs_df)
proximity_test_results_pairs <- anova(proximity_test_pairs, proximity_test2_pairs)
proximity_test_results_pairs

#calculate sex impact via likelihood ratio test
proximity_test_pvalue_pairs <- round(proximity_test_results_pairs$`Pr(>Chisq)`[2], 2)
proximity_test_pvalue_pairs

#test for significance in home range overlap, compare model with and without overlap as a variable
prox_overlap_test_pairs <- glmer(proximity_est ~ overlap_est + (1|site), 
                                 family = Gamma(link = "log"), 
                                 data = proximity_identified_pairs_df)
prox_overlap_test2_pairs <- glmer(proximity_est ~ 1 + (1|site), 
                                  family = Gamma(link = "log"), 
                                  data = proximity_identified_pairs_df)
prox_overlap_test_results_pairs <- anova(prox_overlap_test_pairs, prox_overlap_test2_pairs)
prox_overlap_test_results_pairs

#calculate home-range overlap impact via likelihood ratio test
prox_overlap_test_pvalue_pairs <- round(prox_overlap_test_results_pairs$`Pr(>Chisq)`[2], 2)
prox_overlap_test_pvalue_pairs
```












